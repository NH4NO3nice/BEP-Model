!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!空间内点及边界平滑!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    
MODULE module_space_smooth
    contains
    
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!空间内点五点平滑!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!      
    SUBROUTINE five_smooth_space_in(ub, nx, ny, S_space)
    ! ub：当前时刻物理量
    ! nx, ny：网格数
    ! S_space：时间平滑系数
        IMPLICIT NONE
        INTEGER :: i, j
        INTEGER :: nx, ny
        REAL :: S_space
        REAL :: ub(nx, ny)
        REAL :: u(nx, ny)  ! 过渡量
    
        do i = 2, nx - 1
            do j = 2, ny - 1
                u(i, j) = (1 - S_space) * ub(i, j) + S_space * (ub(i + 1, j) + ub(i, j + 1) + ub(i - 1, j) + ub(i, j - 1)) / 4.0
            enddo
        enddo
    
        do i = 2, nx - 1
            do j = 2, ny - 1
                ub(i, j) = u(i, j)
            enddo
        enddo
        return
    END SUBROUTINE five_smooth_space_in
    
    
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!空间边界九点平滑!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!此处边界指网格第二圈!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    SUBROUTINE nine_smooth_space_out(ub, nx, ny, S_space)
    ! ub：当前时刻物理量
    ! nx, ny：网格数
    ! S_space：时间平滑系数
        IMPLICIT NONE
        INTEGER :: i, j
        INTEGER :: nx, ny
        REAL :: S_space
        REAL :: ub(nx, ny)
        REAL :: u(nx, ny)  ! 过渡量
    
        do i = 2, nx - 1, nx - 3    !  上下边界
            do j = 2, ny - 1
                u(i, j) = (1 - S_space) ** 2 * ub(i, j) + S_space * (1 - S_space) * (ub(i + 1, j) + ub(i - 1, j)) / 2.0 &
                            + S_space * (1 - S_space) * ub(i, j + 1) / 2.0 + S_space ** 2 * (ub(i + 1, j + 1) + ub(i - 1, j + 1)) / 4.0 &
                            + S_space * (1 - S_space) * ub(i, j - 1) / 2.0 + S_space ** 2 * (ub(i + 1, j - 1) + ub(i - 1, j - 1)) / 4.0
            enddo
        enddo
    
        do j = 2, ny - 1, ny - 3    !  左右边界
            do i = 3, nx - 2
                u(i, j) = (1 - S_space) ** 2 * ub(i, j) + S_space * (1 - S_space) * (ub(i + 1, j) + ub(i - 1, j)) / 2.0 &
                            + S_space * (1 - S_space) * ub(i, j + 1) / 2.0 + S_space ** 2 * (ub(i + 1, j + 1) + ub(i - 1, j + 1)) / 4.0 &
                            + S_space * (1 - S_space) * ub(i, j - 1) / 2.0 + S_space ** 2 * (ub(i + 1, j - 1) + ub(i - 1, j - 1)) / 4.0
            enddo
        enddo
    
        !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 传递边界值!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
        do i = 2, nx - 1, nx - 3    !  上下边界
            do j = 2, ny - 1
                ub(i, j) = u(i, j)
            enddo
        enddo
    
        do j = 2, ny - 1, ny - 3    !  左右边界
            do i = 3, nx - 2
                ub(i, j) = u(i, j)
            enddo
        enddo
        return
    END SUBROUTINE nine_smooth_space_out
END MODULE
